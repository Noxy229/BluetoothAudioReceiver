name: Auto-Merge Bot PRs

on:
  pull_request:
    types: [opened, ready_for_review]
  # Auch auf Draft-Status-Änderungen reagieren
  pull_request_target:
    types: [opened, ready_for_review]

permissions:
  contents: write
  pull-requests: write

jobs:
  auto-merge:
    # Nur für PRs vom Jules Bot
    if: github.event.pull_request.user.login == 'google-labs-jules[bot]'
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Mark PR as Ready (if Draft)
      if: github.event.pull_request.draft == true
      run: |
        gh pr ready ${{ github.event.pull_request.number }}
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        
    - name: Wait for checks
      run: |
        echo "Warte 10 Sekunden auf eventuelle Status-Checks..."
        sleep 10
        
    - name: Auto-Merge PR
      run: |
        echo "Versuche PR #${{ github.event.pull_request.number }} zu mergen..."
        gh pr merge ${{ github.event.pull_request.number }} \
          --merge \
          --delete-branch \
          --admin
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
